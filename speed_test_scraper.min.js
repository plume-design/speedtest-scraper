var ooklaTest={config:{firstDownloadStatTimeout:1e4,firstUploadStatTimeout:6e4,testTimeout:12e4,elementHuntTimeoutDefault:3e3,elementHuntPollSpeed:100,reportUnits:!1},_runSpeedTest:function(){var r=this;return new Promise(function(e,n){r._acquireElement(".button__wrapper button.button, .share-assembly button").then(function(t){t[0].click(),r._output("startHandler","started"),r._output("statusHandler","Start button found and clicked"),r._acquireElement(".results-speed .result-tile-download .result-value .number").then(function(e){r._waitForChild(e[0],"span",r.config.firstDownloadStatTimeout).then(function(t){r._output("statusHandler","Download stat watcher starting!!!");r.changeObserver=new MutationObserver(function(t){t.forEach(function(t){r._outputSingleStat(t.target.data,r.config.reportUnits?e[0].parentNode:null,"download")})}),r.changeObserver.observe(t[0],{characterData:!0,subtree:!0}),r._output("statusHandler","Download stat watcher started!!!")},function(t){r._output("statusHandler","error while waiting for download results span"),n(t)})}),r._acquireElement(".results-speed .result-tile-upload .result-value .number").then(function(e){r._waitForChild(e[0],"span",r.config.firstUploadStatTimeout).then(function(t){r._output("statusHandler","Upload stat watcher started!!!");r.changeObserver=new MutationObserver(function(t){t.forEach(function(t){r._outputSingleStat(t.target.data,r.config.reportUnits?e[0].parentNode:null,"upload")})}),r.changeObserver.observe(t[0],{characterData:!0,subtree:!0}),r._output("statusHandler","Upload stat watcher started!!!")},function(t){r._output("statusHandler","error while waiting for upload results span"),n(t)})}),r._acquireElement(".results-speed .result-tile").then(function(t){r._output("statusHandler","Watching for upload area highlight (a.k.a. download complete)");var e={attributes:!0,attributeFilter:["class"],attributeOldValue:!0};r.activationObserver=new MutationObserver(function(t){function n(t){return t.contains("result-tile-download")?"download":t.contains("result-tile-upload")?"upload":"unknown"}t.forEach(function(t){var e=t.oldValue.split(" ");e.includes("result-active-test")&&!t.target.classList.contains("result-active-test")?r._output("startHandler",n(t.target.classList)+"Finished"):!e.includes("result-active-test")&&t.target.classList.contains("result-active-test")&&r._output("startHandler",n(t.target.classList)+"Started")})}),t.forEach(function(t){r.activationObserver.observe(t,e)}),r._output("statusHandler","Upload stat watcher started!!!")}),r._acquireElement(".results-container").then(function(t){r._waitForFinish(t[0]).then(function(){r._output("statusHandler","finished speed test!"),e("finished speed test!")},function(){r._output("statusHandler","speed test failed!"),n("speed test failed (timeout)!")})}),r._acquireElement(".test").then(function(t){r._waitForChild(t[0],".modal__container",!1,!0).then(function(){r._output("statusHandler","Modal error appeared"),n("Modal error appeared")})})},function(t){r._output("statusHandler","finished speed test!"),n("error finding the start button",t)})})},_outputSingleStat:function(t,e,n){var r={test:n,value:parseFloat(t)};if(this.config.reportUnits){var s=e.querySelectorAll(".unit");0<s.length&&(r.unit=s[0].innerText)}this._output("speedHandler",r)},_acquireElement:function(u){var l=this;return new Promise(function(n,r){var s=l.config.elementHuntPollSpeed,a=l.config.elementHuntTimeoutDefault,i=setInterval(function(){!function(){o+=1;var t=document.querySelectorAll(u);if(0<t.length)clearInterval(i),l._output("statusHandler",u+"acquired"),n(t);else if(a/s<o){clearInterval(i);var e="Couldn't find the element \""+u+'" within '+a+"ms";l._output("statusHandler",e),r(e)}}()},s),o=0})},_waitForChild:function(u,l,c,d){var f=this;f.childObservers=f.childObservers||[];var h=f.childObservers.length,t="Waiting for "+l+" in ("+u.classList+") with timeout of "+c+(d?"(Observer index: "+h+").  Watching descendendents.":".");return f._output("statusHandler",t),new Promise(function(n,t){function r(){var t=u.querySelectorAll(l);if(0<t.length){var e='Found "'+l+'" within ('+u.classList+") (oberver index "+h+")";return f._output("statusHandler",e),t}return!1}void 0===c&&(c=f.config.elementHuntTimeoutDefault);var e=r();e&&(f._output("statusHandler","Found element "+l+" right away"),n(e));var s=!1,a={subtree:!!d,childList:!0},i='Timed out waiting for "'+l+'" to appear within ('+u.classList+")";if(c)var o=setTimeout(function(){s||(f._output("statusHandler",i),t(i))},c);f.childObservers.push(new MutationObserver(function(t){t.forEach(function(t){if("childList"==t.type){f._output("statusHandler","childList mutation observed, hunting for "+l);var e=r();e&&(s=!0,f.childObservers[h].disconnect(),c&&clearTimeout(o),n(e))}})})),f.childObservers[h].observe(u,a)})},_waitForFinish:function(a){var i=this;return new Promise(function(e,t){var n=i.config.testTimeout,r=!1,s=setTimeout(function(){r||(i._output("statusHandler","Timed out waiting for test to run within 2 minutes"),t(a))},n);i.finishObserver=new MutationObserver(function(t){t.forEach(function(t){t.target.classList&&t.target.classList.contains("results-container-stage-finished")&&(r=!0,i.finishObserver.disconnect(),clearTimeout(s),e())})}),i.finishObserver.observe(a,{attributes:!0,attributeFilter:["class"]})})},_output:function(t,e){if("andriod"==this.platform);else if("ios"==this.platform)window.webkit.messageHandlers[t].postMessage(e);else{("statusHandler"===t?console.debug:console.log)(t,e)}},_outputStatus:function(t){"andriod"==this.platform||("ios"==this.platform?window.webkit.messageHandlers.statusHandler.postMessage(t):console.log(t)),this._disconnectObservers()},_disconnectObservers:function(){var e=this;["changeObserver","finishObserver"].forEach(function(t){e[t]&&e[t].disconnect()}),e.childObservers.forEach(function(t){t.disconnect()})},_start:function(){var t=this;this._runSpeedTest().then(function(){t._output("resultHandler","completed")},function(){t._output("resultHandler","failed")})},init:function(t){if(t&&(this.platform=t),"ios"==this.platform)this._start();else{document.readyState&&-1<["complete","loaded","interactive"].indexOf(document.readyState)?this._start():document.addEventListener("DOMContentLoaded",function(){this._start()})}}};